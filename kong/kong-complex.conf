# Kong Configuration File for VuNG Bank
# Enterprise API Gateway with Elastic APM Integration

# Basic Configuration
prefix = /usr/local/kong/
log_level = info
proxy_access_log = /dev/stdout
admin_access_log = /dev/stdout
proxy_error_log = /dev/stderr
admin_error_log = /dev/stderr

# Network Configuration
proxy_listen = 0.0.0.0:8086
admin_listen = 0.0.0.0:8001
admin_gui_listen = 0.0.0.0:8002

# SSL Configuration (for production)
ssl_cert_key = /etc/kong/ssl/kong.key
ssl_cert = /etc/kong/ssl/kong.crt

# Database Configuration
database = postgres
pg_host = kong-postgres
pg_port = 5432
pg_timeout = 5000
pg_user = kong
pg_password = kong_pass
pg_database = kong
pg_ssl = off

# Plugin Configuration
plugins = bundled,elastic-apm,correlation-id,request-id,prometheus,file-log
pluginserver_names = 

# Declarative Configuration
declarative_config = /etc/kong/kong.yml

# Security Configuration
untrusted_lua = off
untrusted_lua_sandbox_requires = 
untrusted_lua_sandbox_environment = 

# Performance Configuration
worker_processes = auto
worker_connections = 4096
upstream_keepalive_pool_size = 60
upstream_keepalive_max_requests = 100
upstream_keepalive_idle_timeout = 60s

# Clustering Configuration (for multi-node setup)
cluster_listen = 0.0.0.0:8005
cluster_cert = /etc/kong/cluster.crt
cluster_cert_key = /etc/kong/cluster.key

# Memory Configuration
mem_cache_size = 128m
lua_shared_dict_prometheus_metrics = 5m
lua_shared_dict_kong_db_cache = 128m

# Nginx Configuration
nginx_worker_processes = auto
nginx_daemon = off
nginx_pid = /usr/local/kong/pids/nginx.pid
nginx_http_client_max_body_size = 0
nginx_http_client_body_buffer_size = 8k

# Real IP Configuration
real_ip_header = X-Forwarded-For
real_ip_recursive = on
trusted_ips = 0.0.0.0/0,::/0

# Custom Configuration for VuNG Bank
custom_plugins = elastic-apm

# APM Configuration
lua_package_path = /usr/local/share/lua/5.1/?.lua;/usr/local/share/lua/5.1/?/init.lua;/usr/local/lib/lua/5.1/?.lua;/usr/local/lib/lua/5.1/?/init.lua;./?.lua;./?/init.lua;

# Error Page Configuration
error_default_type = application/json

# Headers Configuration
headers = server_tokens=off

# Client Configuration
client_max_body_size = 0
client_body_buffer_size = 8k